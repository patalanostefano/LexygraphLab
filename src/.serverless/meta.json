{
  "/Users/stefano/Desktop/LexygraphLab/src/serverless.yml": {
    "versionFramework": "4.11.1",
    "servicePath": "/Users/stefano/Desktop/LexygraphLab/src/serverless.yml",
    "serviceConfigFileName": "serverless.yml",
    "service": {
      "service": "valis-document-processing",
      "provider": {
        "name": "aws",
        "region": "eu-central-1",
        "stage": "prod",
        "environment": {
          "STAGE": "prod",
          "RAW_BUCKET": "arn:aws:s3:::valis-documents-raw",
          "DOCUMENTS_TABLE": "valis-documents",
          "COLLECTIONS_TABLE": "valis-document-collections",
          "DOC_PROCESSING_TABLE": "valis-document-processing",
          "PARSER_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-parser-queue",
          "OCR_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-ocr-queue",
          "TEXT_PROCESSING_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-text-processing-queue",
          "SUMMARIZER_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-summarizer-queue"
        },
        "httpApi": {
          "cors": true
        },
        "ecr": {
          "images": {
            "document-parser": {
              "path": "./document-parser-service",
              "platform": "linux/amd64"
            },
            "ocr-service": {
              "path": "./ocr-service",
              "platform": "linux/amd64"
            },
            "text-processing": {
              "path": "./text-processing-service",
              "platform": "linux/amd64"
            },
            "summarizer": {
              "path": "./summarizer-service",
              "platform": "linux/amd64"
            },
            "document-service": {
              "path": "./document-service",
              "platform": "linux/amd64"
            }
          }
        },
        "versionFunctions": true,
        "compiledCloudFormationTemplate": {
          "AWSTemplateFormatVersion": "2010-09-09",
          "Description": "The AWS CloudFormation template for this Serverless application",
          "Resources": {
            "DocumentApiLogGroup": {
              "Type": "AWS::Logs::LogGroup",
              "Properties": {
                "LogGroupName": "/aws/lambda/valis-document-processing-prod-documentApi"
              }
            },
            "TextProcessingApiLogGroup": {
              "Type": "AWS::Logs::LogGroup",
              "Properties": {
                "LogGroupName": "/aws/lambda/valis-document-processing-prod-textProcessingApi"
              }
            },
            "SummarizerApiLogGroup": {
              "Type": "AWS::Logs::LogGroup",
              "Properties": {
                "LogGroupName": "/aws/lambda/valis-document-processing-prod-summarizerApi"
              }
            },
            "DocumentParserLogGroup": {
              "Type": "AWS::Logs::LogGroup",
              "Properties": {
                "LogGroupName": "/aws/lambda/valis-document-processing-prod-documentParser"
              }
            },
            "OcrProcessorLogGroup": {
              "Type": "AWS::Logs::LogGroup",
              "Properties": {
                "LogGroupName": "/aws/lambda/valis-document-processing-prod-ocrProcessor"
              }
            },
            "TextProcessorLogGroup": {
              "Type": "AWS::Logs::LogGroup",
              "Properties": {
                "LogGroupName": "/aws/lambda/valis-document-processing-prod-textProcessor"
              }
            },
            "SummarizerLogGroup": {
              "Type": "AWS::Logs::LogGroup",
              "Properties": {
                "LogGroupName": "/aws/lambda/valis-document-processing-prod-summarizer"
              }
            },
            "IamRoleLambdaExecution": {
              "Type": "AWS::IAM::Role",
              "Properties": {
                "AssumeRolePolicyDocument": {
                  "Version": "2012-10-17",
                  "Statement": [
                    {
                      "Effect": "Allow",
                      "Principal": {
                        "Service": [
                          "lambda.amazonaws.com"
                        ]
                      },
                      "Action": [
                        "sts:AssumeRole"
                      ]
                    }
                  ]
                },
                "Policies": [
                  {
                    "PolicyName": {
                      "Fn::Join": [
                        "-",
                        [
                          "valis-document-processing",
                          "prod",
                          "lambda"
                        ]
                      ]
                    },
                    "PolicyDocument": {
                      "Version": "2012-10-17",
                      "Statement": [
                        {
                          "Effect": "Allow",
                          "Action": [
                            "logs:CreateLogStream",
                            "logs:CreateLogGroup",
                            "logs:TagResource"
                          ],
                          "Resource": [
                            {
                              "Fn::Sub": "arn:${AWS::Partition}:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/lambda/valis-document-processing-prod*:*"
                            }
                          ]
                        },
                        {
                          "Effect": "Allow",
                          "Action": [
                            "logs:PutLogEvents"
                          ],
                          "Resource": [
                            {
                              "Fn::Sub": "arn:${AWS::Partition}:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/lambda/valis-document-processing-prod*:*:*"
                            }
                          ]
                        }
                      ]
                    }
                  }
                ],
                "Path": "/",
                "RoleName": {
                  "Fn::Join": [
                    "-",
                    [
                      "valis-document-processing",
                      "prod",
                      {
                        "Ref": "AWS::Region"
                      },
                      "lambdaRole"
                    ]
                  ]
                }
              }
            }
          },
          "Outputs": {
            "ServerlessDeploymentBucketName": {
              "Value": "serverless-framework-deployments-eu-central-1-30600e17-94a9"
            }
          }
        }
      },
      "functions": {
        "documentApi": {
          "image": {
            "name": "document-service"
          },
          "memorySize": 1024,
          "timeout": 30,
          "events": [
            {
              "http": {
                "path": "/documents",
                "method": "ANY",
                "cors": {
                  "origin": "*",
                  "headers": [
                    "Content-Type",
                    "X-Amz-Date",
                    "Authorization",
                    "X-Api-Key",
                    "X-Amz-Security-Token",
                    "X-Amz-User-Agent"
                  ],
                  "allowCredentials": "<REDACTED>"
                }
              }
            },
            {
              "http": {
                "path": "/documents/{proxy+}",
                "method": "ANY",
                "cors": {
                  "origin": "*",
                  "headers": [
                    "Content-Type",
                    "X-Amz-Date",
                    "Authorization",
                    "X-Api-Key",
                    "X-Amz-Security-Token",
                    "X-Amz-User-Agent"
                  ],
                  "allowCredentials": "<REDACTED>"
                }
              }
            },
            {
              "http": {
                "path": "/collections",
                "method": "ANY",
                "cors": {
                  "origin": "*",
                  "headers": [
                    "Content-Type",
                    "X-Amz-Date",
                    "Authorization",
                    "X-Api-Key",
                    "X-Amz-Security-Token",
                    "X-Amz-User-Agent"
                  ],
                  "allowCredentials": "<REDACTED>"
                }
              }
            },
            {
              "http": {
                "path": "/collections/{proxy+}",
                "method": "ANY",
                "cors": {
                  "origin": "*",
                  "headers": [
                    "Content-Type",
                    "X-Amz-Date",
                    "Authorization",
                    "X-Api-Key",
                    "X-Amz-Security-Token",
                    "X-Amz-User-Agent"
                  ],
                  "allowCredentials": "<REDACTED>"
                }
              }
            }
          ],
          "environment": {
            "SPRING_PROFILES_ACTIVE": "prod",
            "RAW_BUCKET": "arn:aws:s3:::valis-documents-raw",
            "DOCUMENTS_TABLE": "valis-documents",
            "COLLECTIONS_TABLE": "valis-document-collections",
            "DOC_PROCESSING_TABLE": "valis-document-processing",
            "PARSER_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-parser-queue",
            "OCR_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-ocr-queue",
            "TEXT_PROCESSING_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-text-processing-queue",
            "SUMMARIZER_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-summarizer-queue"
          },
          "name": "valis-document-processing-prod-documentApi",
          "package": {}
        },
        "textProcessingApi": {
          "image": {
            "name": "text-processing",
            "command": [
              "app.lambda_handler"
            ]
          },
          "memorySize": 1536,
          "timeout": 30,
          "events": [
            {
              "http": {
                "path": "/documents/{documentId}/extract-entities",
                "method": "post",
                "cors": {
                  "origin": "*",
                  "headers": [
                    "Content-Type",
                    "X-Amz-Date",
                    "Authorization",
                    "X-Api-Key",
                    "X-Amz-Security-Token",
                    "X-Amz-User-Agent"
                  ],
                  "allowCredentials": "<REDACTED>"
                }
              }
            }
          ],
          "environment": {
            "POWERTOOLS_SERVICE_NAME": "text-processing",
            "RAW_BUCKET": "arn:aws:s3:::valis-documents-raw",
            "DOCUMENTS_TABLE": "valis-documents",
            "DOC_PROCESSING_TABLE": "valis-document-processing",
            "SUMMARIZER_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-summarizer-queue"
          },
          "name": "valis-document-processing-prod-textProcessingApi",
          "package": {}
        },
        "summarizerApi": {
          "image": {
            "name": "summarizer",
            "command": [
              "app.lambda_handler"
            ]
          },
          "memorySize": 2048,
          "timeout": 30,
          "events": [
            {
              "http": {
                "path": "/documents/{documentId}/generate-summary",
                "method": "post",
                "cors": {
                  "origin": "*",
                  "headers": [
                    "Content-Type",
                    "X-Amz-Date",
                    "Authorization",
                    "X-Api-Key",
                    "X-Amz-Security-Token",
                    "X-Amz-User-Agent"
                  ],
                  "allowCredentials": "<REDACTED>"
                }
              }
            }
          ],
          "environment": {
            "POWERTOOLS_SERVICE_NAME": "summarizer",
            "DOCUMENTS_TABLE": "valis-documents",
            "DOC_PROCESSING_TABLE": "valis-document-processing"
          },
          "name": "valis-document-processing-prod-summarizerApi",
          "package": {}
        },
        "documentParser": {
          "image": {
            "name": "document-parser",
            "command": [
              "app.lambda_handler"
            ]
          },
          "memorySize": 1024,
          "timeout": 120,
          "events": [
            {
              "sqs": {
                "arn": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-parser-queue",
                "batchSize": 1
              }
            }
          ],
          "environment": {
            "POWERTOOLS_SERVICE_NAME": "document-parser",
            "RAW_BUCKET": "arn:aws:s3:::valis-documents-raw",
            "DOCUMENTS_TABLE": "valis-documents",
            "DOC_PROCESSING_TABLE": "valis-document-processing",
            "TEXT_PROCESSING_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-text-processing-queue",
            "OCR_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-ocr-queue"
          },
          "name": "valis-document-processing-prod-documentParser",
          "package": {}
        },
        "ocrProcessor": {
          "image": {
            "name": "ocr-service",
            "command": [
              "app.lambda_handler"
            ]
          },
          "memorySize": 2048,
          "timeout": 120,
          "events": [
            {
              "sqs": {
                "arn": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-ocr-queue",
                "batchSize": 1
              }
            }
          ],
          "environment": {
            "POWERTOOLS_SERVICE_NAME": "ocr-service",
            "RAW_BUCKET": "arn:aws:s3:::valis-documents-raw",
            "DOCUMENTS_TABLE": "valis-documents",
            "DOC_PROCESSING_TABLE": "valis-document-processing",
            "TEXT_PROCESSING_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-text-processing-queue"
          },
          "name": "valis-document-processing-prod-ocrProcessor",
          "package": {}
        },
        "textProcessor": {
          "image": {
            "name": "text-processing",
            "command": [
              "app.lambda_handler"
            ]
          },
          "memorySize": 1536,
          "timeout": 120,
          "events": [
            {
              "sqs": {
                "arn": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-text-processing-queue",
                "batchSize": 1
              }
            }
          ],
          "environment": {
            "POWERTOOLS_SERVICE_NAME": "text-processing",
            "RAW_BUCKET": "arn:aws:s3:::valis-documents-raw",
            "DOCUMENTS_TABLE": "valis-documents",
            "DOC_PROCESSING_TABLE": "valis-document-processing",
            "SUMMARIZER_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-summarizer-queue"
          },
          "name": "valis-document-processing-prod-textProcessor",
          "package": {}
        },
        "summarizer": {
          "image": {
            "name": "summarizer",
            "command": [
              "app.lambda_handler"
            ]
          },
          "memorySize": 2048,
          "timeout": 120,
          "events": [
            {
              "sqs": {
                "arn": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-summarizer-queue",
                "batchSize": 1
              }
            }
          ],
          "environment": {
            "POWERTOOLS_SERVICE_NAME": "summarizer",
            "DOCUMENTS_TABLE": "valis-documents",
            "DOC_PROCESSING_TABLE": "valis-document-processing"
          },
          "name": "valis-document-processing-prod-summarizer",
          "package": {}
        }
      },
      "custom": {
        "environment": {
          "RAW_BUCKET": "arn:aws:s3:::valis-documents-raw",
          "DOCUMENTS_TABLE": "valis-documents",
          "COLLECTIONS_TABLE": "valis-document-collections",
          "DOC_PROCESSING_TABLE": "valis-document-processing",
          "OCR_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-ocr-queue",
          "TEXT_PROCESSING_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-text-processing-queue",
          "SUMMARIZER_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-summarizer-queue",
          "PARSER_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-parser-queue",
          "AUTH_JWT_ISSUER": "https://sjfdkgzmjaasjtavuhfu.supabase.co",
          "AUTH_JWT_JWK_SET_URI": "NQwq0GPdFUc1caCNLEHg/qDnvnXqcfyoYV4U66wgD+dUEh/xYXEElSZqLsSyx6rLhXrW5YB+8KDX2UHu7gQUhg=="
        }
      },
      "outputs": {
        "ApiGatewayUrl": {
          "Description": "URL of the Valis Document Processing API",
          "Value": {
            "Fn::Join": [
              "",
              [
                "https://",
                {
                  "Ref": "ApiGatewayRestApi"
                },
                ".execute-api.eu-central-1.amazonaws.com/prod"
              ]
            ]
          }
        }
      }
    },
    "provider": {
      "name": "aws",
      "region": "eu-central-1",
      "stage": "prod",
      "environment": {
        "STAGE": "prod",
        "RAW_BUCKET": "arn:aws:s3:::valis-documents-raw",
        "DOCUMENTS_TABLE": "valis-documents",
        "COLLECTIONS_TABLE": "valis-document-collections",
        "DOC_PROCESSING_TABLE": "valis-document-processing",
        "PARSER_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-parser-queue",
        "OCR_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-ocr-queue",
        "TEXT_PROCESSING_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-text-processing-queue",
        "SUMMARIZER_QUEUE": "arn:aws:sqs:eu-central-1:078652648484:valis-documents-summarizer-queue"
      },
      "httpApi": {
        "cors": true
      },
      "ecr": {
        "images": {
          "document-parser": {
            "path": "./document-parser-service",
            "platform": "linux/amd64"
          },
          "ocr-service": {
            "path": "./ocr-service",
            "platform": "linux/amd64"
          },
          "text-processing": {
            "path": "./text-processing-service",
            "platform": "linux/amd64"
          },
          "summarizer": {
            "path": "./summarizer-service",
            "platform": "linux/amd64"
          },
          "document-service": {
            "path": "./document-service",
            "platform": "linux/amd64"
          }
        }
      },
      "versionFunctions": true,
      "compiledCloudFormationTemplate": {
        "AWSTemplateFormatVersion": "2010-09-09",
        "Description": "The AWS CloudFormation template for this Serverless application",
        "Resources": {
          "DocumentApiLogGroup": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
              "LogGroupName": "/aws/lambda/valis-document-processing-prod-documentApi"
            }
          },
          "TextProcessingApiLogGroup": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
              "LogGroupName": "/aws/lambda/valis-document-processing-prod-textProcessingApi"
            }
          },
          "SummarizerApiLogGroup": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
              "LogGroupName": "/aws/lambda/valis-document-processing-prod-summarizerApi"
            }
          },
          "DocumentParserLogGroup": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
              "LogGroupName": "/aws/lambda/valis-document-processing-prod-documentParser"
            }
          },
          "OcrProcessorLogGroup": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
              "LogGroupName": "/aws/lambda/valis-document-processing-prod-ocrProcessor"
            }
          },
          "TextProcessorLogGroup": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
              "LogGroupName": "/aws/lambda/valis-document-processing-prod-textProcessor"
            }
          },
          "SummarizerLogGroup": {
            "Type": "AWS::Logs::LogGroup",
            "Properties": {
              "LogGroupName": "/aws/lambda/valis-document-processing-prod-summarizer"
            }
          },
          "IamRoleLambdaExecution": {
            "Type": "AWS::IAM::Role",
            "Properties": {
              "AssumeRolePolicyDocument": {
                "Version": "2012-10-17",
                "Statement": [
                  {
                    "Effect": "Allow",
                    "Principal": {
                      "Service": [
                        "lambda.amazonaws.com"
                      ]
                    },
                    "Action": [
                      "sts:AssumeRole"
                    ]
                  }
                ]
              },
              "Policies": [
                {
                  "PolicyName": {
                    "Fn::Join": [
                      "-",
                      [
                        "valis-document-processing",
                        "prod",
                        "lambda"
                      ]
                    ]
                  },
                  "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                      {
                        "Effect": "Allow",
                        "Action": [
                          "logs:CreateLogStream",
                          "logs:CreateLogGroup",
                          "logs:TagResource"
                        ],
                        "Resource": [
                          {
                            "Fn::Sub": "arn:${AWS::Partition}:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/lambda/valis-document-processing-prod*:*"
                          }
                        ]
                      },
                      {
                        "Effect": "Allow",
                        "Action": [
                          "logs:PutLogEvents"
                        ],
                        "Resource": [
                          {
                            "Fn::Sub": "arn:${AWS::Partition}:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/lambda/valis-document-processing-prod*:*:*"
                          }
                        ]
                      }
                    ]
                  }
                }
              ],
              "Path": "/",
              "RoleName": {
                "Fn::Join": [
                  "-",
                  [
                    "valis-document-processing",
                    "prod",
                    {
                      "Ref": "AWS::Region"
                    },
                    "lambdaRole"
                  ]
                ]
              }
            }
          }
        },
        "Outputs": {
          "ServerlessDeploymentBucketName": {
            "Value": "serverless-framework-deployments-eu-central-1-30600e17-94a9"
          }
        }
      }
    },
    "dashboard": {
      "isEnabledForService": false,
      "requiredAuthentication": false,
      "orgFeaturesInUse": null,
      "orgObservabilityIntegrations": null,
      "serviceAppId": null,
      "serviceProvider": null,
      "instanceParameters": null
    },
    "error": {
      "message": "Encountered error during executing: docker build -t serverless-valis-document-processing-prod:document-service -f /Users/stefano/Desktop/LexygraphLab/src/document-service/Dockerfile /Users/stefano/Desktop/LexygraphLab/src/document-service --platform=linux/amd64\nOutput of the command:\n#1 [internal] load build definition from Dockerfile\n#1 sha256:b35dc836cec2bc4f51f515a09f4d9432182f22fed8a178d1211adb48ff1a283f\n#1 transferring dockerfile: 265B 0.0s done\n#1 DONE 0.0s\n\n#2 [internal] load .dockerignore\n#2 sha256:17abf56da00c5d32a4afd84c8a192e03b28496016f8021b2b57a15f310b68c39\n#2 transferring context: 2B done\n#2 DONE 0.0s\n\n#3 [internal] load metadata for docker.io/amazon/aws-lambda-java:11\n#3 sha256:eac2370f4230e51a5b097eb258f825f78518e85d3bb8ef4541500e0256d7335e\n#3 DONE 3.5s\n\n#5 [internal] load build context\n#5 sha256:1c26d1f56e01d105abadd8b0b5c3255fcefba79a265ba2e386a2068166b076b3\n#5 transferring context: 28B 0.0s done\n#5 DONE 0.1s\n\n#4 [1/2] FROM docker.io/amazon/aws-lambda-java:11@sha256:491dd352c23a49e932960774cbd097615d630acfb1b5b1ff3b12fc3d1096c93f\n#4 sha256:0c838ffe608522f2130a41b2c8d1c560687542cba219a063eb9c519a9358160a\n#4 resolve docker.io/amazon/aws-lambda-java:11@sha256:491dd352c23a49e932960774cbd097615d630acfb1b5b1ff3b12fc3d1096c93f 0.0s done\n#4 sha256:491dd352c23a49e932960774cbd097615d630acfb1b5b1ff3b12fc3d1096c93f 1.58kB / 1.58kB done\n#4 sha256:f090d4026f2c29c8afa2257f15d9af0f3e5c5a8b6d603b1fc4469c00f9a50343 3.00kB / 3.00kB done\n#4 CANCELED\n\n#6 [2/2] COPY target/document-service-1.0.0.jar /var/task/lib/document-service.jar\n#6 sha256:4bee1b9bfe8e662ce62a756a5228bc682e5bb57471fdc4a1e552de7c9477f700\n#6 ERROR: \"/target/document-service-1.0.0.jar\" not found: not found\n------\n > [2/2] COPY target/document-service-1.0.0.jar /var/task/lib/document-service.jar:\n------\nfailed to compute cache key: \"/target/document-service-1.0.0.jar\" not found: not found\n",
      "stack": "ServerlessError2: Encountered error during executing: docker build -t serverless-valis-document-processing-prod:document-service -f /Users/stefano/Desktop/LexygraphLab/src/document-service/Dockerfile /Users/stefano/Desktop/LexygraphLab/src/document-service --platform=linux/amd64\nOutput of the command:\n#1 [internal] load build definition from Dockerfile\n#1 sha256:b35dc836cec2bc4f51f515a09f4d9432182f22fed8a178d1211adb48ff1a283f\n#1 transferring dockerfile: 265B 0.0s done\n#1 DONE 0.0s\n\n#2 [internal] load .dockerignore\n#2 sha256:17abf56da00c5d32a4afd84c8a192e03b28496016f8021b2b57a15f310b68c39\n#2 transferring context: 2B done\n#2 DONE 0.0s\n\n#3 [internal] load metadata for docker.io/amazon/aws-lambda-java:11\n#3 sha256:eac2370f4230e51a5b097eb258f825f78518e85d3bb8ef4541500e0256d7335e\n#3 DONE 3.5s\n\n#5 [internal] load build context\n#5 sha256:1c26d1f56e01d105abadd8b0b5c3255fcefba79a265ba2e386a2068166b076b3\n#5 transferring context: 28B 0.0s done\n#5 DONE 0.1s\n\n#4 [1/2] FROM docker.io/amazon/aws-lambda-java:11@sha256:491dd352c23a49e932960774cbd097615d630acfb1b5b1ff3b12fc3d1096c93f\n#4 sha256:0c838ffe608522f2130a41b2c8d1c560687542cba219a063eb9c519a9358160a\n#4 resolve docker.io/amazon/aws-lambda-java:11@sha256:491dd352c23a49e932960774cbd097615d630acfb1b5b1ff3b12fc3d1096c93f 0.0s done\n#4 sha256:491dd352c23a49e932960774cbd097615d630acfb1b5b1ff3b12fc3d1096c93f 1.58kB / 1.58kB done\n#4 sha256:f090d4026f2c29c8afa2257f15d9af0f3e5c5a8b6d603b1fc4469c00f9a50343 3.00kB / 3.00kB done\n#4 CANCELED\n\n#6 [2/2] COPY target/document-service-1.0.0.jar /var/task/lib/document-service.jar\n#6 sha256:4bee1b9bfe8e662ce62a756a5228bc682e5bb57471fdc4a1e552de7c9477f700\n#6 ERROR: \"/target/document-service-1.0.0.jar\" not found: not found\n------\n > [2/2] COPY target/document-service-1.0.0.jar /var/task/lib/document-service.jar:\n------\nfailed to compute cache key: \"/target/document-service-1.0.0.jar\" not found: not found\n\n    at Object.defineProperties.resolveImageUriAndShaFromPath.promise (file:///Users/stefano/.serverless/releases/4.11.1/package/dist/sf-core.js:562:2284)",
      "code": "DOCKER_BUILD_ERROR"
    },
    "serviceRawFile": "service: valis-document-processing\n\nprovider:\n  name: aws\n  region: ${opt:region, 'eu-central-1'}\n  stage: ${opt:stage, 'prod'}\n  environment:\n    STAGE: ${opt:stage, 'prod'}\n    RAW_BUCKET: ${self:custom.environment.RAW_BUCKET}\n    DOCUMENTS_TABLE: ${self:custom.environment.DOCUMENTS_TABLE}\n    COLLECTIONS_TABLE: ${self:custom.environment.COLLECTIONS_TABLE}\n    DOC_PROCESSING_TABLE: ${self:custom.environment.DOC_PROCESSING_TABLE}\n    PARSER_QUEUE: ${self:custom.environment.PARSER_QUEUE}\n    OCR_QUEUE: ${self:custom.environment.OCR_QUEUE}\n    TEXT_PROCESSING_QUEUE: ${self:custom.environment.TEXT_PROCESSING_QUEUE}\n    SUMMARIZER_QUEUE: ${self:custom.environment.SUMMARIZER_QUEUE}\n  httpApi:\n    cors: true\n\n  ecr:\n    images:\n      document-parser:\n        path: ./document-parser-service\n        platform: linux/amd64\n      ocr-service:\n        path: ./ocr-service\n        platform: linux/amd64\n      text-processing:\n        path: ./text-processing-service\n        platform: linux/amd64\n      summarizer:\n        path: ./summarizer-service\n        platform: linux/amd64\n      document-service:\n        path: ./document-service\n        platform: linux/amd64\n\nfunctions:\n  # Document Service API Gateway Handler - Single function for all document & collection endpoints\n  documentApi:\n    image:\n      name: document-service\n    memorySize: 1024\n    timeout: 30\n    events:\n      # Handle documents endpoints\n      - http:\n          path: /documents\n          method: ANY\n          cors:\n            origin: '*'\n            headers:\n              - Content-Type\n              - X-Amz-Date\n              - Authorization\n              - X-Api-Key\n              - X-Amz-Security-Token\n              - X-Amz-User-Agent\n            allowCredentials: false\n      - http:\n          path: /documents/{proxy+}\n          method: ANY\n          cors:\n            origin: '*'\n            headers:\n              - Content-Type\n              - X-Amz-Date\n              - Authorization\n              - X-Api-Key\n              - X-Amz-Security-Token\n              - X-Amz-User-Agent\n            allowCredentials: false\n      # Handle collections endpoints\n      - http:\n          path: /collections\n          method: ANY\n          cors:\n            origin: '*'\n            headers:\n              - Content-Type\n              - X-Amz-Date\n              - Authorization\n              - X-Api-Key\n              - X-Amz-Security-Token\n              - X-Amz-User-Agent\n            allowCredentials: false\n      - http:\n          path: /collections/{proxy+}\n          method: ANY\n          cors:\n            origin: '*'\n            headers:\n              - Content-Type\n              - X-Amz-Date\n              - Authorization\n              - X-Api-Key\n              - X-Amz-Security-Token\n              - X-Amz-User-Agent\n            allowCredentials: false\n    environment:\n      SPRING_PROFILES_ACTIVE: prod\n      RAW_BUCKET: ${self:custom.environment.RAW_BUCKET}\n      DOCUMENTS_TABLE: ${self:custom.environment.DOCUMENTS_TABLE}\n      COLLECTIONS_TABLE: ${self:custom.environment.COLLECTIONS_TABLE}\n      DOC_PROCESSING_TABLE: ${self:custom.environment.DOC_PROCESSING_TABLE}\n      PARSER_QUEUE: ${self:custom.environment.PARSER_QUEUE}\n      OCR_QUEUE: ${self:custom.environment.OCR_QUEUE}\n      TEXT_PROCESSING_QUEUE: ${self:custom.environment.TEXT_PROCESSING_QUEUE}\n      SUMMARIZER_QUEUE: ${self:custom.environment.SUMMARIZER_QUEUE}\n\n  # Direct access to text processing for entity extraction\n  textProcessingApi:\n    image:\n      name: text-processing\n      command:\n        - \"app.lambda_handler\"\n    memorySize: 1536\n    timeout: 30\n    events:\n      - http:\n          path: /documents/{documentId}/extract-entities\n          method: post\n          cors:\n            origin: '*'\n            headers:\n              - Content-Type\n              - X-Amz-Date\n              - Authorization\n              - X-Api-Key\n              - X-Amz-Security-Token\n              - X-Amz-User-Agent\n            allowCredentials: false\n    environment:\n      POWERTOOLS_SERVICE_NAME: text-processing\n      RAW_BUCKET: ${self:custom.environment.RAW_BUCKET}\n      DOCUMENTS_TABLE: ${self:custom.environment.DOCUMENTS_TABLE}\n      DOC_PROCESSING_TABLE: ${self:custom.environment.DOC_PROCESSING_TABLE}\n      SUMMARIZER_QUEUE: ${self:custom.environment.SUMMARIZER_QUEUE}\n\n  # Direct access to summarizer for on-demand summaries\n  summarizerApi:\n    image:\n      name: summarizer\n      command:\n        - \"app.lambda_handler\"\n    memorySize: 2048\n    timeout: 30\n    events:\n      - http:\n          path: /documents/{documentId}/generate-summary\n          method: post\n          cors:\n            origin: '*'\n            headers:\n              - Content-Type\n              - X-Amz-Date\n              - Authorization\n              - X-Api-Key\n              - X-Amz-Security-Token\n              - X-Amz-User-Agent\n            allowCredentials: false\n    environment:\n      POWERTOOLS_SERVICE_NAME: summarizer\n      DOCUMENTS_TABLE: ${self:custom.environment.DOCUMENTS_TABLE}\n      DOC_PROCESSING_TABLE: ${self:custom.environment.DOC_PROCESSING_TABLE}\n\n  # Processing Pipeline Functions\n  documentParser:\n    image:\n      name: document-parser\n      command:\n        - \"app.lambda_handler\"\n    memorySize: 1024\n    timeout: 120\n    events:\n      - sqs:\n          arn: ${self:custom.environment.PARSER_QUEUE}\n          batchSize: 1\n    environment:\n      POWERTOOLS_SERVICE_NAME: document-parser\n      RAW_BUCKET: ${self:custom.environment.RAW_BUCKET}\n      DOCUMENTS_TABLE: ${self:custom.environment.DOCUMENTS_TABLE}\n      DOC_PROCESSING_TABLE: ${self:custom.environment.DOC_PROCESSING_TABLE}\n      TEXT_PROCESSING_QUEUE: ${self:custom.environment.TEXT_PROCESSING_QUEUE}\n      OCR_QUEUE: ${self:custom.environment.OCR_QUEUE}\n\n  ocrProcessor:\n    image:\n      name: ocr-service\n      command:\n        - \"app.lambda_handler\"\n    memorySize: 2048\n    timeout: 120\n    events:\n      - sqs:\n          arn: ${self:custom.environment.OCR_QUEUE}\n          batchSize: 1\n    environment:\n      POWERTOOLS_SERVICE_NAME: ocr-service\n      RAW_BUCKET: ${self:custom.environment.RAW_BUCKET}\n      DOCUMENTS_TABLE: ${self:custom.environment.DOCUMENTS_TABLE}\n      DOC_PROCESSING_TABLE: ${self:custom.environment.DOC_PROCESSING_TABLE}\n      TEXT_PROCESSING_QUEUE: ${self:custom.environment.TEXT_PROCESSING_QUEUE}\n\n  textProcessor:\n    image:\n      name: text-processing\n      command:\n        - \"app.lambda_handler\"\n    memorySize: 1536\n    timeout: 120\n    events:\n      - sqs:\n          arn: ${self:custom.environment.TEXT_PROCESSING_QUEUE}\n          batchSize: 1\n    environment:\n      POWERTOOLS_SERVICE_NAME: text-processing\n      RAW_BUCKET: ${self:custom.environment.RAW_BUCKET}\n      DOCUMENTS_TABLE: ${self:custom.environment.DOCUMENTS_TABLE}\n      DOC_PROCESSING_TABLE: ${self:custom.environment.DOC_PROCESSING_TABLE}\n      SUMMARIZER_QUEUE: ${self:custom.environment.SUMMARIZER_QUEUE}\n\n  summarizer:\n    image:\n      name: summarizer\n      command:\n        - \"app.lambda_handler\"\n    memorySize: 2048\n    timeout: 120\n    events:\n      - sqs:\n          arn: ${self:custom.environment.SUMMARIZER_QUEUE}\n          batchSize: 1\n    environment:\n      POWERTOOLS_SERVICE_NAME: summarizer\n      DOCUMENTS_TABLE: ${self:custom.environment.DOCUMENTS_TABLE}\n      DOC_PROCESSING_TABLE: ${self:custom.environment.DOC_PROCESSING_TABLE}\n    \ncustom:\n  environment: ${file(env.${opt:stage, 'prod'}.yml)}\n\n# Output the API Gateway URL for reference\noutputs:\n  ApiGatewayUrl:\n    Description: \"URL of the Valis Document Processing API\"\n    Value: \n      Fn::Join:\n        - \"\"\n        - - \"https://\"\n          - Ref: ApiGatewayRestApi\n          - \".execute-api.${self:provider.region}.amazonaws.com/${self:provider.stage}\"\n",
    "command": [
      "deploy"
    ],
    "options": {
      "stage": "prod",
      "verbose": true
    },
    "orgId": "66e687b3-f12b-4cfc-8e3a-8ecbeb76dd0d",
    "orgName": "lexygraphai",
    "userId": "fb7f8bKKNS5hP61Z9N",
    "userName": "lexygraphai",
    "serviceProviderAwsAccountId": "078652648484",
    "serviceProviderAwsCfStackName": "valis-document-processing-prod",
    "serviceProviderAwsCfStackId": "arn:aws:cloudformation:eu-central-1:078652648484:stack/valis-document-processing-prod/0ac17e50-0e79-11f0-892a-02eaee40b12f",
    "serviceProviderAwsCfStackCreated": "2025-03-31T21:42:28.404Z",
    "serviceProviderAwsCfStackUpdated": null,
    "serviceProviderAwsCfStackStatus": "CREATE_COMPLETE",
    "serviceProviderAwsCfStackOutputs": [
      {
        "OutputKey": "DocumentApiLambdaFunctionQualifiedArn",
        "OutputValue": "arn:aws:lambda:eu-central-1:078652648484:function:valis-document-processing-prod-documentApi:3",
        "Description": "Current Lambda function version",
        "ExportName": "sls-valis-document-processing-prod-DocumentApiLambdaFunctionQualifiedArn"
      },
      {
        "OutputKey": "TextProcessorLambdaFunctionQualifiedArn",
        "OutputValue": "arn:aws:lambda:eu-central-1:078652648484:function:valis-document-processing-prod-textProcessor:3",
        "Description": "Current Lambda function version",
        "ExportName": "sls-valis-document-processing-prod-TextProcessorLambdaFunctionQualifiedArn"
      },
      {
        "OutputKey": "OcrProcessorLambdaFunctionQualifiedArn",
        "OutputValue": "arn:aws:lambda:eu-central-1:078652648484:function:valis-document-processing-prod-ocrProcessor:3",
        "Description": "Current Lambda function version",
        "ExportName": "sls-valis-document-processing-prod-OcrProcessorLambdaFunctionQualifiedArn"
      },
      {
        "OutputKey": "DocumentParserLambdaFunctionQualifiedArn",
        "OutputValue": "arn:aws:lambda:eu-central-1:078652648484:function:valis-document-processing-prod-documentParser:3",
        "Description": "Current Lambda function version",
        "ExportName": "sls-valis-document-processing-prod-DocumentParserLambdaFunctionQualifiedArn"
      },
      {
        "OutputKey": "SummarizerLambdaFunctionQualifiedArn",
        "OutputValue": "arn:aws:lambda:eu-central-1:078652648484:function:valis-document-processing-prod-summarizer:3",
        "Description": "Current Lambda function version",
        "ExportName": "sls-valis-document-processing-prod-SummarizerLambdaFunctionQualifiedArn"
      },
      {
        "OutputKey": "ServiceEndpoint",
        "OutputValue": "https://ej9aw0b6h0.execute-api.eu-central-1.amazonaws.com/prod",
        "Description": "URL of the service endpoint",
        "ExportName": "sls-valis-document-processing-prod-ServiceEndpoint"
      },
      {
        "OutputKey": "ServerlessDeploymentBucketName",
        "OutputValue": "serverless-framework-deployments-eu-central-1-30600e17-94a9",
        "ExportName": "sls-valis-document-processing-prod-ServerlessDeploymentBucketName"
      }
    ]
  }
}